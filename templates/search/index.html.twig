{% extends 'base.html.twig' %}

{% block title %}Property Search
{% endblock %}

{% block body %}
	<div class="container">
		<div class="card shadow-sm">
			<div class="card-header bg-primary text-white">
				<h1 class="mb-0">Property Search</h1>
			</div>

			<div class="card-body">
				<form action="{{ path('app_search') }}" method="get">
					<div class="input-group">
						<input type="text" name="query" class="form-control form-control-lg" placeholder="Example: '3-bedroom house under $500k in Paris'" value="{{ query }}" aria-label="Search properties">

						<select name="filter" class="form-select form-select-lg">
							<option value="">Defualt</option>
							<option value="min_price" {{ selectedFilter == 'min_price' ? 'selected' }}>Minimum Price</option>
							<option value="max_price" {{ selectedFilter == 'max_price' ? 'selected' }}>Maximum Price</option>
							<option value="min_bedrooms" {{ selectedFilter == 'min_bedrooms' ? 'selected' }}>Minimum Bedrooms</option>
							<option value="max_bedrooms" {{ selectedFilter == 'max_bedrooms' ? 'selected' }}>Maximum Bedrooms</option>
						</select>

						<button class="btn btn-primary btn-lg" type="submit">
							<i class="bi bi-search"></i>
							Search
						</button>
					</div>
				</form>

				{% if results %}
					<div class="mt-4">
						<h3 class="mb-3">
							{% if selectedFilter %}
								{{ selectedFilter|replace({'_': ' '})|title }}
								Results
							{% else %}
								Search Results ({{ results|length }})
							{% endif %}
						</h3>

						<div class="alert alert-info mb-4">
							<strong>Search Criteria:</strong>
							{% if criteria.type %}
								<span class="badge bg-primary me-2">{{ criteria.type|capitalize }}</span>
							{% endif %}
							{% if criteria.bedrooms %}
								<span class="badge bg-primary me-2">{{ criteria.bedrooms }}
									Bedrooms</span>
							{% endif %}
							{% if criteria.price %}
								<span class="badge bg-primary me-2">
									{% if criteria.price.operator == 'BETWEEN' %}
										Price BETWEEN ${{ criteria.price.min|number_format }}
										AND ${{ criteria.price.max|number_format }}
									{% else %}
										Price
										{{ criteria.price.operator }}
										${{ criteria.price.value|number_format }}
									{% endif %}
								</span>
							{% endif %}
							{% if criteria.location %}
								<span class="badge bg-primary me-2">{{ criteria.location|capitalize }}</span>
							{% endif %}
						</div>

						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>Type</th>
										<th>Bedrooms</th>
										<th>Price</th>
										<th>Location</th>
									</tr>
								</thead>
								<tbody>
									{% for property in results %}
										<tr class="{% if selectedFilter %}table-warning{% endif %}">
											<td>{{ property.type|capitalize }}</td>
											<td>{{ property.bedrooms }}</td>
											<td>${{ property.price|number_format }}</td>
											<td>{{ property.location|capitalize }}</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				{% elseif query %}
					<div class="alert alert-warning mt-4">
						No properties found for "<strong>{{ query }}</strong>".
					</div>
				{% endif %}

				{# Recommendations sections remain the same #}

				{% if recommendations.better_deals is not empty %}
					<div class="mt-5">
						<h4>Better Deals in
							{{ criteria.location }}</h4>
						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>Type</th>
										<th>Bedrooms</th>
										<th>Price</th>
										<th>Location</th>
									</tr>
								</thead>
								<tbody>
									{% for property in recommendations.better_deals %}
										<tr>
											<td>{{ property.type|capitalize }}</td>
											<td>{{ property.bedrooms }}</td>
											<td>${{ property.price|number_format }}</td>
											<td>{{ property.location }}</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				{% endif %}

				{% if recommendations.premium is not empty %}
					<div class="mt-5">
						<h4>Premium Options in
							{{ criteria.location }}</h4>
						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>Type</th>
										<th>Bedrooms</th>
										<th>Price</th>
										<th>Location</th>
									</tr>
								</thead>
								<tbody>
									{% for property in recommendations.premium %}
										<tr>
											<td>{{ property.type|capitalize }}</td>
											<td>{{ property.bedrooms }}</td>
											<td>${{ property.price|number_format }}</td>
											<td>{{ property.location }}</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				{% endif %}

				{% if recommendations.nearby is not empty %}
					<div class="mt-5">
						<h4>Recommended Properties</h4>
						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>Type</th>
										<th>Bedrooms</th>
										<th>Price</th>
										<th>Location</th>
									</tr>
								</thead>
								<tbody>
									{% for property in recommendations.nearby %}
										<tr>
											<td>{{ property.type|capitalize }}</td>
											<td>{{ property.bedrooms }}</td>
											<td>${{ property.price|number_format }}</td>
											<td>{{ property.location }}</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
